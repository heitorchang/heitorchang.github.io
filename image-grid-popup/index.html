
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Image + Grid Overlay</title>
    <style>
    body { font-family: sans-serif; margin: 16px; background: #fafafa; }
    input { margin-bottom: 10px; }
    canvas { border: 1px solid #ccc; display: block; }
    #cellPopup {
      position: fixed;
      padding: 6px 10px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      border-radius: 6px;
      font-size: 14px;
      pointer-events: none;
      z-index: 9999;
      display: none;
    }
    </style>
  </head>
  <body>
    <input type="file" id="fileInput" accept="image/*"><br>
    Line color: <input id="linecolor" value="#000">;
    Grid spacing: <input id="gridspacing" onkeyup="updategridspacing()" value="32"><br>
    <button onclick="draw(true)">Redraw</button> &nbsp;&nbsp;&nbsp;
    <button onclick="draw(false)">Clear grid</button><br>
    <canvas id="canvas"></canvas>
    <div id="cellPopup"></div>

    <script>

    let GRID_SPACING = parseInt(document.getElementById("gridspacing").value); // pixels between grid lines

    function updategridspacing() {
      GRID_SPACING = parseInt(document.getElementById("gridspacing").value);
    }

    const MARGIN = 40;       // extra space for labels

    const fileInput = document.getElementById('fileInput');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let img = new Image();
    const popup = document.getElementById("cellPopup");

    function colLabel(i) { return (i + 1).toString(); }

    function rowLabel(i) {
      let s = '', n = i + 1;
      while (n > 0) {
        n--; s = String.fromCharCode(65 + (n % 26)) + s;
        n = Math.floor(n / 26);
      }
      return s;
    }

    function draw(hasgrid) {
      if (!img.complete) return;
      const iw = img.naturalWidth;
      const ih = img.naturalHeight;

      const cw = iw + MARGIN;
      const ch = ih + MARGIN;
      canvas.width = cw;
      canvas.height = ch;

      // draw background
      ctx.fillStyle = '#eee';
      ctx.fillRect(0, 0, cw, ch);

      // draw image offset by margins
      ctx.drawImage(img, MARGIN, MARGIN);

      if (!hasgrid) {
        return;
      }

      // grid lines
      ctx.strokeStyle = document.getElementById('linecolor').value;
      ctx.lineWidth = 1;
      ctx.beginPath();

      for (let x = MARGIN; x <= MARGIN + iw; x += GRID_SPACING) {
        ctx.moveTo(x + 0.5, MARGIN);
        ctx.lineTo(x + 0.5, MARGIN + ih);
      }
      for (let y = MARGIN; y <= MARGIN + ih; y += GRID_SPACING) {
        ctx.moveTo(MARGIN, y + 0.5);
        ctx.lineTo(MARGIN + iw, y + 0.5);
      }
      ctx.stroke();

      // labels
      ctx.font = '14px sans-serif';
      ctx.fillStyle = 'black';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';

      const cols = Math.ceil(iw / GRID_SPACING);
      const rows = Math.ceil(ih / GRID_SPACING);

      // top numeric labels
      for (let c = 0; c < cols; c++) {
        const x = MARGIN + c * GRID_SPACING + GRID_SPACING / 2;
        ctx.fillText(colLabel(c), x, MARGIN / 2);
      }

      // left alphabetic labels
      ctx.textAlign = 'right';
      for (let r = 0; r < rows; r++) {
        const y = MARGIN + r * GRID_SPACING + GRID_SPACING / 2;
        ctx.fillText(rowLabel(r), MARGIN - 8, y);
      }
    }

    // Click / tap handler
    canvas.addEventListener("click", e => {
      if (!img.complete) return;
      const x = e.offsetX - MARGIN;
      const y = e.offsetY - MARGIN;

      if (x < 0 || y < 0 || x > canvas.width || y > canvas.height) return;

      const col = Math.floor(x / GRID_SPACING);
      const row = Math.floor(y / GRID_SPACING);

      const label = rowLabel(row) + colLabel(col);

      popup.textContent = label;
      popup.style.left = e.clientX + 10 + "px";
      popup.style.top = e.clientY + 10 + "px";
      popup.style.display = "block";

      clearTimeout(popup._t);
      popup._t = setTimeout(() => {
        popup.style.display = "none";
      }, 1500);
    });

    fileInput.addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      const url = URL.createObjectURL(file);
      img.onload = () => {
        draw(true);
        URL.revokeObjectURL(url);
      };
      img.src = url;
    });
    </script>
  </body>
</html>

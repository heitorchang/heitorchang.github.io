<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Noteboard</title>
    <style>
    .card {
      display: inline-block;
      padding: 0.2rem 0.5rem 0.5rem 0.5rem;
      border: 1px solid #ccc;
      cursor: move;
      width: 15rem;
      height: 6.1rem;
      background-color: #eef;
      position: absolute;
    }

    .cardtext {
      border: 0;
      width: 100%;
      height: 4.6rem;
      resize: none;
    }

    #saveload {
      position: absolute;
      width: 100%;
      left: 0;
      bottom: 0;
    }

    #saveloadtext {
      width: 98%;
      height: 5rem;
    }

    .unsaved {
      color: #922;
      background-color: #fcd;
    }

    .hideunsaved {
      color: white;
      background-color: white;
    }

    .spanx {
      position: relative; top: 0; font-size: 1.2rem;
      cursor: pointer;
    }

    #unsaveddiv {
      display: inline-block;
    }
    </style>
  </head>
  <body>
    <div>
      Save as: <input id="saveasname" length="6"> <button onclick="save()">Save</button>
      <div id="unsaveddiv" class="hideunsaved">*unsaved*</div>
      Load:
      <select id="loadselect" onchange="load()">
        <option value="board_reset">New board</option>
      </select>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <button onclick="reset()">Reset</button>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      Delete (re-type): <input id="deletename" length="6"> <button onclick="deleteItem()">Delete</button>
    </div>
    <div class="card" id="c0" draggable="true"><span class="spanx" onclick="clr(0)">&times;</span><textarea class="cardtext" id="c0t" onclick="unsave()"></textarea></div>
    <div class="card" id="c1" draggable="true"><span class="spanx" onclick="clr(1)">&times;</span><textarea class="cardtext" id="c1t" onclick="unsave()"></textarea></div>
    <div class="card" id="c2" draggable="true"><span class="spanx" onclick="clr(2)">&times;</span><textarea class="cardtext" id="c2t" onclick="unsave()"></textarea></div>
    <div class="card" id="c3" draggable="true"><span class="spanx" onclick="clr(3)">&times;</span><textarea class="cardtext" id="c3t" onclick="unsave()"></textarea></div>
    <div class="card" id="c4" draggable="true"><span class="spanx" onclick="clr(4)">&times;</span><textarea class="cardtext" id="c4t" onclick="unsave()"></textarea></div>
    <div class="card" id="c5" draggable="true"><span class="spanx" onclick="clr(5)">&times;</span><textarea class="cardtext" id="c5t" onclick="unsave()"></textarea></div>
    <div class="card" id="c6" draggable="true"><span class="spanx" onclick="clr(6)">&times;</span><textarea class="cardtext" id="c6t" onclick="unsave()"></textarea></div>
    <div class="card" id="c7" draggable="true"><span class="spanx" onclick="clr(7)">&times;</span><textarea class="cardtext" id="c7t" onclick="unsave()"></textarea></div>
    <div class="card" id="c8" draggable="true"><span class="spanx" onclick="clr(8)">&times;</span><textarea class="cardtext" id="c8t" onclick="unsave()"></textarea></div>
    <div class="card" id="c9" draggable="true"><span class="spanx" onclick="clr(9)">&times;</span><textarea class="cardtext" id="c9t" onclick="unsave()"></textarea></div>
    <div class="card" id="c10" draggable="true"><span class="spanx" onclick="clr(10)">&times;</span><textarea class="cardtext" id="c10t" onclick="unsave()"></textarea></div>
    <div class="card" id="c11" draggable="true"><span class="spanx" onclick="clr(11)">&times;</span><textarea class="cardtext" id="c11t" onclick="unsave()"></textarea></div>
    <div class="card" id="c12" draggable="true"><span class="spanx" onclick="clr(12)">&times;</span><textarea class="cardtext" id="c12t" onclick="unsave()"></textarea></div>
    <div class="card" id="c13" draggable="true"><span class="spanx" onclick="clr(13)">&times;</span><textarea class="cardtext" id="c13t" onclick="unsave()"></textarea></div>
    <div class="card" id="c14" draggable="true"><span class="spanx" onclick="clr(14)">&times;</span><textarea class="cardtext" id="c14t" onclick="unsave()"></textarea></div>
    <div class="card" id="c15" draggable="true"><span class="spanx" onclick="clr(15)">&times;</span><textarea class="cardtext" id="c15t" onclick="unsave()"></textarea></div>
    <div class="card" id="c16" draggable="true"><span class="spanx" onclick="clr(16)">&times;</span><textarea class="cardtext" id="c16t" onclick="unsave()"></textarea></div>
    <div class="card" id="c17" draggable="true"><span class="spanx" onclick="clr(17)">&times;</span><textarea class="cardtext" id="c17t" onclick="unsave()"></textarea></div>
    <div class="card" id="c18" draggable="true"><span class="spanx" onclick="clr(18)">&times;</span><textarea class="cardtext" id="c18t" onclick="unsave()"></textarea></div>
    <div class="card" id="c19" draggable="true"><span class="spanx" onclick="clr(19)">&times;</span><textarea class="cardtext" id="c19t" onclick="unsave()"></textarea></div>

    <script src="jquery-ui/external/jquery/jquery.js"></script>
    <script src="jquery-ui/jquery-ui.min.js"></script>
    <script>
    function clr(i) {
      $("#c" + i + "t").val('');
      $("#c" + i).css({top: YOFFSET, left: 0});
      carddata["c" + i + "X"] = 0;
      carddata["c" + i + "Y"] = YOFFSET;
      carddata["c" + i + "Z"] = i;
      carddata["c" + i + "t"] = '';
      unsave();
    }

    const YOFFSET = 40;
    let CURRENTZ = 20;  // increase by 1 every time a card is dragged

    let carddata = {
      c0X: 0,
      c1X: 0,
      c2X: 0,
      c3X: 0,
      c4X: 0,
      c5X: 0,
      c6X: 0,
      c7X: 0,
      c8X: 0,
      c9X: 0,
      c10X: 0,
      c11X: 0,
      c12X: 0,
      c13X: 0,
      c14X: 0,
      c15X: 0,
      c16X: 0,
      c17X: 0,
      c18X: 0,
      c19X: 0,
      c0Y: YOFFSET,
      c1Y: YOFFSET,
      c2Y: YOFFSET,
      c3Y: YOFFSET,
      c4Y: YOFFSET,
      c5Y: YOFFSET,
      c6Y: YOFFSET,
      c7Y: YOFFSET,
      c8Y: YOFFSET,
      c9Y: YOFFSET,
      c10Y: YOFFSET,
      c11Y: YOFFSET,
      c12Y: YOFFSET,
      c13Y: YOFFSET,
      c14Y: YOFFSET,
      c15Y: YOFFSET,
      c16Y: YOFFSET,
      c17Y: YOFFSET,
      c18Y: YOFFSET,
      c19Y: YOFFSET,
      c0Z: 19,
      c1Z: 18,
      c2Z: 17,
      c3Z: 16,
      c4Z: 15,
      c5Z: 14,
      c6Z: 13,
      c7Z: 12,
      c8Z: 11,
      c9Z: 10,
      c10Z: 9,
      c11Z: 8,
      c12Z: 7,
      c13Z: 6,
      c14Z: 5,
      c15Z: 4,
      c16Z: 3,
      c17Z: 2,
      c18Z: 1,
      c19Z: 0,
      c0t: '',
      c1t: '',
      c2t: '',
      c3t: '',
      c4t: '',
      c5t: '',
      c6t: '',
      c7t: '',
      c8t: '',
      c9t: '',
      c10t: '',
      c11t: '',
      c12t: '',
      c13t: '',
      c14t: '',
      c15t: '',
      c16t: '',
      c17t: '',
      c18t: '',
      c19t: '',
    };

    $(".card").draggable({
      stop: function (event) {
        CURRENTZ++;
        carddata[event.target.id + 'X'] = event.clientX - event.offsetX;
        carddata[event.target.id + 'Y'] = event.clientY - event.offsetY;
        carddata[event.target.id + 'Z'] = CURRENTZ;
        $("#" + event.target.id).css({zIndex: CURRENTZ});
        unsave();
      },
    });

    function save() {
      for (let i = 0; i < 20; i++) {
        carddata["c" + i + "t"] = $("#c" + i + "t").val();
      }
      carddatastr = JSON.stringify(carddata);
      const boardname = 'board_' + $("#saveasname").val()
      localStorage.setItem(boardname, carddatastr);
      populateLoadSelect();
      $("#unsaveddiv").addClass("hideunsaved");
      $("#unsaveddiv").removeClass("unsaved");
    }

    function unsave() {
      $("#unsaveddiv").addClass("unsaved");
      $("#unsaveddiv").removeClass("hideunsaved");
    }

    function setdata() {
      // set data
      for (let i = 0; i < 20; i++) {
        $("#c" + i).css({top: carddata["c" + i + "Y"], left: carddata["c" + i + "X"], zIndex: carddata["c" + i + "Z"]});
        $("#c" + i + "t").val(carddata["c" + i + "t"]);
      }
    }

    function load() {
      const boardname = $("#loadselect").val();
      if (localStorage.getItem(boardname)) {
        carddata = JSON.parse(localStorage.getItem(boardname));
      } else {
        console.log("Could not load from localStorage.");
        return;
      }

      setdata();

      $("#saveasname").val(boardname.substring(6));
      $("#unsaveddiv").addClass("hideunsaved");
      $("#unsaveddiv").removeClass("unsaved");
    }

    function reset() {
      $("#saveasname").val("reset");
      for (let i = 0; i < 20; i++) {
        carddata["c" + i + "X"] = 0;
        carddata["c" + i + "Y"] = YOFFSET;
        carddata["c" + i + "Z"] = 20 - 1 - i;
        CURRENTZ = 20;
        $("#c" + i + "t").val('');
        carddata["c" + i + "t"] = '';
      }
      save();
      $("#loadselect").val("board_reset");
      load();
      $("#saveasname").val("");
    }

    function deleteItem() {
      localStorage.removeItem("board_" + $("#deletename").val());
      localStorage.removeItem($("#deletename").val());
      populateLoadSelect();
    }

    function populateLoadSelect() {
      $("#loadselect").html('<option value="board_reset">New board</option>');
      Object.keys(localStorage).sort().forEach((key) => {
        if (key.startsWith("board_")) {
          $("#loadselect").append($("<option>", {
            value: key,
            text: key,
          }));
        }
      });
    }

    reset();
    populateLoadSelect();
    setdata();
    </script>
  </body>
</html>
